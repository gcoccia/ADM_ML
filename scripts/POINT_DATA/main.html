<html>
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/highcharts.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/modules/exporting.js" type="text/javascript"></script>
    <script type="text/javascript"> 

/*Obtain all the data at once from the server*/
function Request_Data(variables) {
 var Output;
 idate = Date.UTC(parseInt($("#iyear").val()),parseInt($("#imonth").val()-1),parseInt($("#iday").val()))/1000;
 fdate = Date.UTC(parseInt($("#fyear").val()),parseInt($("#fmonth").val()-1),parseInt($("#fday").val())+1)/1000;
 lat = $("#latitude").val();
 lon = $("#longitude").val();
 tstep = $('input:radio[name=tstep]:checked').val();//"DAILY";
 script = 'python Extract_Point_Data.py'
 input = {idate:idate,fdate:fdate,tstep:tstep,lat:lat,lon:lon,variables:variables};
 input = JSON.stringify(input);
 request = {script:script,input:input};
 $.ajax({
  type:"post",
  url: 'Jquery_Python_JSON_Glue.php',
  data: request,
  success: function(response){
   Output = JSON.parse(response);
  },
  async: false,
  cache: false
 });	
 return Output;
}

$(function() {
 var variables = {SPI:['spi1','spi3','spi6','spi12']};
 Plot_Data(variables,'Drought Indices');
});

function Request_and_Display() {
 plot = $('input:radio[name=plot]:checked').val();
 if (plot == "Drought_Indices"){
  //Drought Indices
  var variables = {SPI:['spi1','spi3','spi6','spi12']};
  Plot_Data(variables,'Drought Indices');
 }
 else if (plot == "Water_Balance"){
  //Water Balance
  var variables = {PGF:['prec'],VIC_PGF:['runoff','baseflow','evap']};
  Plot_Data(variables,'Water Balance');
 }
 //Precipitation Products
 else if (plot == "Surface_Fluxes"){
  //Surface Fluxes
  var variables = {VIC_PGF:['net_short','net_long','r_net']};
  Plot_Data(variables,'Surface Fluxes');
 };
 //TO DO: 
 //Specify the type of plot on entry per variable, order in plot of variable (e.g. prec at back and column...)
};

function Plot_Data(variables,subtitle) {
 
 //Request data for these variables
 var Output = Request_Data(variables); 
 //Create the input for the chart
 var chart_options = {
      xAxis: {type: 'datetime',},
      yAxis: [],
      legend: {layout: 'horizontal',align: 'center',verticalAlign: 'bottom',},
      series: [],
      title: {text: subtitle,},
      subtitle: {text: 'African Water Cycle Monitor',},
     };
 for (variable in Output["VARIABLES"]){
  var units = Output["VARIABLES"][variable]["units"];
  var series = {
       marker: {enabled: false},
       id: variable,
       name: variable,
       type: 'spline',
       yAxis: units,
       pointInterval: Output["TIME"]["pointInterval"],
       pointStart: Date.UTC(Output["TIME"]["iyear"],Output["TIME"]["imonth"]-1,Output["TIME"]["iday"]),
       data: Output["VARIABLES"][variable]["data"],
      };
  //Determine if we need a new axis. If so add it
  new_axis = true;
  for (i in chart_options.yAxis){
   id = chart_options.yAxis[i].id;
   if (id == units){new_axis = false;}
  };
  if (new_axis == true){
   var opposite=true;
   if(chart_options.yAxis.length%2 == 0){opposite=false;}
   var yAxis = {
        title: {text: units},
        name: units ,
        id: units,
        opposite: opposite,
       }
   chart_options.yAxis.push(yAxis);
  }; 
  //Add the series
  chart_options.series.push(series);
  };
 //Create the chart
 var chart = $('#container').highcharts(chart_options);
};

    </script>
  </head>

  <body>
    <div id="container"></div>
    <div id="controls"></div>
    <button onclick="Request_and_Display()">Update Plot</button>
    <br>
    Plots:
    <br>
    <input type="radio" name="plot" value="Drought_Indices" checked=checked>Drought Indices
    <input type="radio" name="plot" value="Water_Balance" >Water Balance
    <input type="radio" name="plot" value="Surface_Fluxes" >Surface Fluxes
    <br>
    Time Step: (Only Daily works for now...)
    <br>
    <input type="radio" name="tstep" value="DAILY" checked=checked>Daily 
    <input type="radio" name="tstep" value="MONTHLY" >Monthly
    <input type="radio" name="tstep" value="YEARLY" >Yearly
    <br>
    <!-- Date info -->
    Initial Time: (1 jan 2001 - 31 dec 2001)
    <br>
    <input type="text" id="iyear" value=2001>
    <input type="text" id="imonth" value=1>
    <input type="text" id="iday" value=1>
    <br>
    Final Time:  
    <br>
    <input type="text" id="fyear" value=2001>
    <input type="text" id="fmonth" value=1>
    <input type="text" id="fday" value=10>
    <br> 
    Latitude: (Other coordinates won't work for now)
    <br>
    <input type="text" id="latitude" value=-34.6250>
    <br>
    Longitude:
    <br>
    <input type="text" id="longitude" value=19.8750>
    <br>
  </body>
</html>
